(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{137:function(e,t,n){},139:function(e,t,n){},141:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(70),u=n.n(i),o=(n(80),n(3)),c=n(4),l=n(6),s=n(5),d=n(7),m=n(144),h=n(143),f="/account",p=r.a.createContext(null),b=function(e){return function(t){return r.a.createElement(p.Consumer,null,function(n){return r.a.createElement(e,Object.assign({},t,{firebase:n}))})}},v=p,E=n(39),g=n.n(E),O=(n(127),n(129),{apiKey:"AIzaSyD8lYCIoZbCEXJ9PFi2Bi3sGR0LooEfFtU",authDomain:"tearound-ebad6.firebaseapp.com",databaseURL:"https://tearound-ebad6.firebaseio.com",projectId:"tearound-ebad6",storageBucket:"tearound-ebad6.appspot.com",messagingSenderId:"807239904616"}),k=function e(){var t=this;Object(o.a)(this,e),this.doCreateUserWithEmailAndPassword=function(e,n,a){return t.auth.createUserWithEmailAndPassword(e,a).then(function(){return t.db.ref("/users/"+t.auth.currentUser.uid+"/details").set({uid:t.auth.currentUser.uid,email:e,name:n})})},this.doSignInWithEmailAndPassword=function(e,n){return t.auth.signInWithEmailAndPassword(e,n)},this.doSignOut=function(){return t.auth.signOut()},this.doPasswordReset=function(e){return t.auth.sendPasswordResetEmail(e)},this.doPasswordUpdate=function(e){return t.auth.currentUser.updatePassword(e)},this.addUserData=function(e){t.db.ref("users/"+t.auth.currentUser.uid).set({todos:e}).catch(function(e){return console.error(e)})},this.getData=function(){var e=t.auth.currentUser.uid;return t.db.ref("/users/"+e).once("value").then(function(e){return e.val()&&e.val().todos||[]})},this.addFriend=function(e){return t.db.ref("users/").once("value").then(function(n){var a=n.val()||[],r=Object.values(a).find(function(t){return t.details.email===e});return!(!r||r.details.uid===t.auth.currentUser.uid)&&(t.db.ref("users/"+r.details.uid+"/friends").push({email:t.auth.currentUser.email,uid:t.auth.currentUser.uid,outbound:!1,invited:!0,accepted:!1}),t.db.ref("users/"+t.auth.currentUser.uid+"/friends/").push({email:r.details.email,uid:r.details.uid,outbound:!0,invited:!0,accepted:!1}).catch(function(e){return console.err(e)}))})},this.acceptFriend=function(e,n){return t.db.ref("users/").once("value").then(function(a){var r=a.val()||[],i=Object.values(r).map(function(t,n){return t.details.email===e.email&&Object.keys(t.friends)}).filter(function(e){return!1!==e}).concat([]);return!(!i||!e||e.uid===t.auth.currentUser.uid)&&(t.db.ref("users/"+e.uid+"/friends/"+i).set({email:t.auth.currentUser.email,uid:t.auth.currentUser.uid,outbound:!1,invited:!0,accepted:!0}),t.db.ref("users/"+t.auth.currentUser.uid+"/friends/"+n).set({email:e.email,uid:e.uid,outbound:!0,invited:!0,accepted:!0}).catch(function(e){return console.err(e)}))})},this.inviteFriend=function(e){t.db.ref("users/"+t.auth.currentUser.uid+"/inviteFriends").remove();var n=t.auth.currentUser.displayName;return t.db.ref("users/"+t.auth.currentUser.uid+"/inviteFriends").set({email:e,inviteName:n})},this.removeFriend=function(e,n){return t.db.ref("users/"+t.auth.currentUser.uid+"/friends/"+n).remove()},this.getFriends=function(){return t.db.ref("users/"+t.auth.currentUser.uid+"/friends").once("value").then(function(e){return e.val()||[]})},this.initializeTeaRound=function(e){var n=e.map(function(e){return e.email});t.db.ref("users/"+t.auth.currentUser.uid+"/teaRound").update({uid:t.auth.currentUser.uid,email:t.auth.currentUser.email,friends:n,time:Date.now()})},this.addDrink=function(e,n,a){t.db.ref("users/"+n+"/teaRound/drinks").push({drink:e,email:t.auth.currentUser.email,notes:a})},this.removeDrink=function(e,n){t.db.ref("users/"+e+"/teaRound/drinks/"+n).remove()},this.updateDrink=function(e,n,a,r){return r&&a?t.db.ref("users/"+e+"/teaRound/drinks/"+n).update({drink:a,email:t.auth.currentUser.email,notes:r}):r?t.db.ref("users/"+e+"/teaRound/drinks/"+n).update({email:t.auth.currentUser.email,notes:r}):a?t.db.ref("users/"+e+"/teaRound/drinks/"+n).update({drink:a,email:t.auth.currentUser.email}):void 0},this.getDrinks=function(e){return t.db.ref("users/"+e+"/teaRound/drinks").once("value").then(function(e){return e.val()||[]})},g.a.initializeApp(O),this.auth=g.a.auth(),this.db=g.a.database()},j=n(142),y=n(145),w=n(11),C="ORDER_CREATED",S="LOWEST_FIRST",U="HIGHEST_FIRST",D=Object(w.b)()(Object(y.a)(b(function(e){var t=e.firebase,n=e.history,a=e.dispatch;return r.a.createElement("button",{onClick:function(){t.doSignOut(),n.push("/signin"),a({type:"CLEAR_STATE"})}},"Sign Out")}))),A=function(){return r.a.createElement("div",null,r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(j.a,{to:f},"Account")),r.a.createElement("li",null,r.a.createElement(j.a,{to:"/admin"},"Admin")),r.a.createElement(D,null)))},T=function(){return r.a.createElement("div",null,r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(j.a,{to:"/signin"},"Login"))))},R=function(e){var t=e.authUser;return r.a.createElement("div",null,t?r.a.createElement(A,null):r.a.createElement(T,null))},I=n(13),F=n(10),M=function(e){function t(){var e,n;Object(o.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(l.a)(this,(e=Object(s.a)(t)).call.apply(e,[this].concat(r)))).state={email:"",password:"",errorMessage:null},n.changeValue=function(e,t){n.setState(Object(F.a)({},t,e.target.value))},n.onSubmit=function(e){var t=n.state,a=t.email,r=t.password,i=n.props,u=i.firebase,o=i.history;u.doSignInWithEmailAndPassword(a,r).then(function(e){n.setState(Object(I.a)({},n.state)),o.push(f)}).catch(function(e){n.setState({errorMessage:e.message})}),e.preventDefault()},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this,t=this.state.errorMessage;return r.a.createElement("form",{onSubmit:function(t){return e.onSubmit(t)}},r.a.createElement("label",null,"Email",r.a.createElement("input",{type:"email",onChange:function(t){return e.changeValue(t,"email")},placeholder:"email"})),r.a.createElement("label",null,"Password",r.a.createElement("input",{type:"password",onChange:function(t){return e.changeValue(t,"password")},placeholder:"password"})),r.a.createElement("button",{type:"submit"},"Login"),t&&r.a.createElement("p",null,"Looks like the email or password is incorrect"))}}]),t}(a.PureComponent),L=Object(y.a)(b(M)),P=function(e){function t(){return Object(o.a)(this,t),Object(l.a)(this,Object(s.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement(L,null),r.a.createElement(j.a,{to:"/signup"},r.a.createElement("button",null,"Add account")),r.a.createElement(j.a,{to:"/pw-forget"},r.a.createElement("button",null,"Forgot Password")))}}]),t}(a.PureComponent),_=function(e){var t=e.onClick,n=e.completed,a=e.text;return r.a.createElement("div",null,r.a.createElement("p",null,a),r.a.createElement("p",null,n),r.a.createElement("button",{onClick:t},"Completed"))},V=b(function(e){var t=e.todos,n=e.claimTodo,a=e.firebase;return t.length>0&&a.addUserData(t),t&&t.length>0&&t.map(function(e){return r.a.createElement(_,Object.assign({key:e.id},e,{onClick:function(){return n(e.id)}}))})}),N=function(e,t){return e.completed<t.completed?-1:e.completed>t.completed?1:0},W=function(e,t){switch(t){case C:return e;case S:return e.sort(N);case U:return e.sort(N).reverse();default:throw new Error("Unknown filter: "+t)}},x=Object(w.b)(function(e){return{todos:W(e.todos,e.visibilityFilters)}},function(e){return{claimTodo:function(t){return e(function(e){return{type:"CLAIM_TODO",id:e}}(t))}}})(V),B=function(e){var t=e.active,n=e.children,a=e.onClick;return r.a.createElement("button",{onClick:a,disabled:t,style:{marginLeft:"4px"}},n)},z=Object(w.b)(function(e,t){return{active:t.filter===e.visibilityFilter}},function(e,t){return{onClick:function(){return e({type:"SET_VISIBILITY_FILTER",filter:t.filter})}}})(B),H=function(){return r.a.createElement("div",null,r.a.createElement("span",null,"Show: "),r.a.createElement(z,{filter:C},"FIRST"),r.a.createElement(z,{filter:S},"LOWEST"),r.a.createElement(z,{filter:U},"HIGHEST"))},Y=Object(w.b)()(function(e){var t,n=e.dispatch;return r.a.createElement("div",null,r.a.createElement("form",{onSubmit:function(e){var a;e.preventDefault(),t.value.trim()&&(n((a=t.value,{type:"ADD_TODO",id:Math.random(),text:a})),t.value="")}},r.a.createElement("input",{ref:function(e){return t=e}}),r.a.createElement("button",{type:"submit"},"Add Todo")))}),G=function(e){var t=e.total;return r.a.createElement("p",null,"You owe ",t," tea rounds")},J=function(e){for(var t=0,n=0;n<e.length;n++)t+=e[n].completed;return t},K=Object(w.b)(function(e){return{total:J(e.todos)}})(G),X=b(function(e){function t(){var e,n;Object(o.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(l.a)(this,(e=Object(s.a)(t)).call.apply(e,[this].concat(r)))).state={password:"",success:!1},n.onChange=function(e,t){n.setState(Object(F.a)({},t,e.target.value))},n.onSubmit=function(e){var t=n.state.password;n.props.firebase.doPasswordUpdate(t).then(function(e){n.setState({password:"",success:!0})}).catch(function(e){n.setState({errorMessage:e.message})}),e.preventDefault()},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this,t=this.state.success;return r.a.createElement("form",{onSubmit:function(t){return e.onSubmit(t)}},r.a.createElement("input",{type:"password",onChange:function(t){return e.onChange(t,"password")}}),r.a.createElement("button",{type:"submit"},"Set new password"),t&&r.a.createElement("div",null,"Successfully changed password"))}}]),t}(a.PureComponent)),Z=function(e){function t(){var e,n;Object(o.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(l.a)(this,(e=Object(s.a)(t)).call.apply(e,[this].concat(r)))).state={loading:!0},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props,n=t.firebase,a=t.dispatch;n.auth.onAuthStateChanged(function(t){return t&&n.getData().then(function(t){a({type:"CALL_TODO",todos:t}),e.setState({loading:!1})})})}},{key:"render",value:function(){var e=this.state.loading;return r.a.createElement("div",{className:"App"},r.a.createElement(X,null),r.a.createElement(Y,null),e?r.a.createElement("div",null,"Loading"):r.a.createElement("div",null,r.a.createElement(x,null),r.a.createElement(K,null)),r.a.createElement(H,null))}}]),t}(a.Component),$=b(Object(w.b)()(Z)),q=function(e){function t(){var e,n;Object(o.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(l.a)(this,(e=Object(s.a)(t)).call.apply(e,[this].concat(r)))).state={name:"",email:"",password:"",errorMessage:null},n.changeValue=function(e,t){n.setState(Object(F.a)({},t,e.target.value))},n.onSubmit=function(e){var t=n.state,a=t.email,r=t.name,i=t.password;n.props.firebase.doCreateUserWithEmailAndPassword(a,r,i).then(function(e){n.setState(Object(I.a)({},n.state)),n.props.history.push(f)}).catch(function(e){n.setState({errorMessage:e.message})}),e.preventDefault()},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this,t=this.state.errorMessage;return r.a.createElement("form",{onSubmit:function(t){return e.onSubmit(t)}},r.a.createElement("div",null,t),r.a.createElement("label",null,"Name:",r.a.createElement("input",{onChange:function(t){return e.changeValue(t,"name")}})),r.a.createElement("label",null,"Email:",r.a.createElement("input",{onChange:function(t){return e.changeValue(t,"email")}})),r.a.createElement("label",null,"Password:",r.a.createElement("input",{type:"password",onChange:function(t){return e.changeValue(t,"password")}})),r.a.createElement("button",{type:"submit"},"Submit"))}}]),t}(a.PureComponent),Q=Object(y.a)(b(q)),ee=function(e){function t(){return Object(o.a)(this,t),Object(l.a)(this,Object(s.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement(Q,null))}}]),t}(a.PureComponent),te=function(e){function t(){var e,n;Object(o.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(l.a)(this,(e=Object(s.a)(t)).call.apply(e,[this].concat(r)))).state={email:""},n.changeValue=function(e,t){n.setState(Object(F.a)({},t,e.target.value))},n.onSubmit=function(e){var t=n.state.email;n.props.firebase.doPasswordReset(t).then(function(e){n.setState(Object(I.a)({},n.state))}).catch(function(e){n.setState({errorMessage:e.message})}),e.preventDefault()},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement("form",{onSubmit:function(t){return e.onSubmit(t)}},r.a.createElement("p",null,"Type the email you signed up with to reset your password"),r.a.createElement("input",{type:"email",onChange:function(t){return e.changeValue(t,"email")},placeholder:"email"}),r.a.createElement("button",{type:"submit"},"Send"))}}]),t}(a.PureComponent),ne=Object(y.a)(b(te)),ae=(n(137),function(e){var t=e.toggleModal,n=e.show,a=e.children;return r.a.createElement("div",{className:n?"modal display-block":"modal display-none"},r.a.createElement("section",{className:"modal-main"},a,r.a.createElement("button",{onClick:t(!1)},"close")))}),re=function(e){function t(){var e,n;Object(o.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(l.a)(this,(e=Object(s.a)(t)).call.apply(e,[this].concat(r)))).state={email:"",friends:[],keys:[],friendMessage:!1,showModal:!1},n.updateFriendList=function(){n.props.firebase.getFriends().then(function(e){var t=Object.values(e),a=Object.keys(e);n.setState({friends:t,keys:a})})},n.onChange=function(e,t){n.setState(Object(F.a)({},t,e.target.value))},n.clearInput=function(){n.setState({email:""})},n.toggleModal=function(e){n.setState({showModal:e})},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.props.firebase.auth.onAuthStateChanged(function(t){return t&&e.updateFriendList()})}},{key:"render",value:function(){var e=this,t=this.props,n=t.firebase,a=t.history,i=this.state,u=i.friends,o=i.keys,c=i.email,l=i.friendMessage,s=i.showModal;return r.a.createElement("div",null,r.a.createElement("input",{type:"email",value:this.state.email,onChange:function(t){return e.onChange(t,"email")}}),r.a.createElement("button",{onClick:function(){n.addFriend(e.state.email).then(function(t){!1===t?e.setState({friendMessage:!0,showModal:!0}):(e.updateFriendList(),e.clearInput())})}},"Add friend"),r.a.createElement("div",null,r.a.createElement("h3",null,"Friends"),u.map(function(t,a){return r.a.createElement("div",{key:t.uid},t.invited&&!t.accepted&&t.outbound&&r.a.createElement("p",null,t.email," - Invited"),t.invited&&!t.accepted&&!t.outbound&&r.a.createElement("div",null,r.a.createElement("p",null,t.email),r.a.createElement("button",{onClick:function(){n.acceptFriend(t,o[a]),e.updateFriendList()}},"Accept")),t.invited&&t.accepted&&r.a.createElement("div",null,r.a.createElement("p",null,t.email," - in round"),r.a.createElement("span",{onClick:function(){n.removeFriend(t),e.updateFriendList()}},"x")))}),l&&r.a.createElement(ae,{toggleModal:function(){return e.toggleModal},show:s},r.a.createElement("p",null,"It looks like ",c," doesn't have an account. Invite them now"),r.a.createElement("button",{onClick:function(){n.inviteFriend(c),e.toggleModal(!1)}},"Send Invite email"))),r.a.createElement("button",{onClick:function(){n.initializeTeaRound(e.state.friends),a.push("/teaRound?".concat(n.auth.currentUser.uid))}},"Trigger Tea Round"))}}]),t}(a.PureComponent),ie=Object(y.a)(b(re)),ue=b(function(e){function t(){var e,n;Object(o.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(l.a)(this,(e=Object(s.a)(t)).call.apply(e,[this].concat(r)))).state={drinks:[],drinkChoice:null,notes:"",updating:!1},n.teaRoundUid=window.location.search.split("?")[1],n.getDrinks=function(){n.props.firebase.getDrinks(n.teaRoundUid).then(function(e){var t=Object.values(e).map(function(t,n){return Object(I.a)({},t,{key:Object.keys(e)[n]})});n.setState({drinks:t})})},n.setDrinkChoice=function(e){n.setState({drinkChoice:e})},n.onChange=function(e,t){return n.setState(Object(F.a)({},t,e.target.value))},n.toggleUpdating=function(e){n.setState({updating:e})},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.getDrinks()}},{key:"render",value:function(){var e=this,t=this.props.firebase,n=this.state,a=n.drinks,i=n.drinkChoice,u=n.notes,o=n.updating,c=n.changeDrink,l=n.changeNotes;return r.a.createElement("div",null,r.a.createElement("button",{onClick:function(){return e.setDrinkChoice("tea")}},"Tea"),r.a.createElement("button",{onClick:function(){return e.setDrinkChoice("coffee")}},"Coffee"),r.a.createElement("button",{onClick:function(){return e.setDrinkChoice("other")}},"Other"),i&&r.a.createElement("label",null,"Notes:",r.a.createElement("input",{placeholder:"any preferences, e.g. 1 sugar, soya milk",onChange:function(t){return e.onChange(t,"notes")}}),r.a.createElement("button",{onClick:function(){t.addDrink(i,e.teaRoundUid,u),e.getDrinks()}},"Order ",i)),r.a.createElement("div",null,r.a.createElement("h2",null,"Drinks"),a.map(function(n){return r.a.createElement("div",{key:n.key},r.a.createElement("p",null,n.email),o===n.key?r.a.createElement("div",null,r.a.createElement("input",{placeholder:n.drink,onChange:function(t){return e.onChange(t,"changeDrink")}}),r.a.createElement("input",{placeholder:n.notes,onChange:function(t){return e.onChange(t,"changeNotes")}})):r.a.createElement("p",null,n.drink,n.notes&&" - ".concat(n.notes)),r.a.createElement("button",{onClick:function(){o&&t.updateDrink(e.teaRoundUid,n.key,c,l).then(function(){e.toggleUpdating(!1),e.getDrinks()}),e.toggleUpdating(n.key)}},"Update"),o&&r.a.createElement("button",{onClick:function(){return e.toggleUpdating(!1)}},"Undo"),r.a.createElement("button",{onClick:function(){t.removeDrink(e.teaRoundUid,n.key),e.getDrinks()}},"Remove"))})))}}]),t}(r.a.PureComponent)),oe=(n(139),b(function(e){function t(){var e,n;Object(o.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(l.a)(this,(e=Object(s.a)(t)).call.apply(e,[this].concat(r)))).state={authUser:null},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.props.firebase.auth.onAuthStateChanged(function(t){t?e.setState({authUser:t}):e.setState({authUser:null})})}},{key:"render",value:function(){return r.a.createElement(m.a,null,r.a.createElement("div",{className:"App"},r.a.createElement(R,{authUser:this.state.authUser}),r.a.createElement("hr",null),r.a.createElement(h.a,{path:"/signin",component:P}),r.a.createElement(h.a,{path:f,component:$}),r.a.createElement(h.a,{path:"/admin",component:ie}),r.a.createElement(h.a,{path:"/tearound",component:ue}),r.a.createElement(h.a,{path:"/signup",component:ee}),r.a.createElement(h.a,{path:"/pw-forget",component:ne})))}}]),t}(a.PureComponent)));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var ce=n(26),le=n(74),se=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"ADD_TODO":return[].concat(Object(le.a)(e),[{id:t.id,text:t.text,completed:0}]);case"CLAIM_TODO":return e.map(function(e){return e.id===t.id?Object(I.a)({},e,{completed:e.completed+1}):e});case"CALL_TODO":return t.todos;case"CLEAR_STATE":return[];default:return e}},de=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:C,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_VISIBILITY_FILTER":return t.filter;default:return e}},me=Object(ce.b)({todos:se,visibilityFilters:de}),he=Object(ce.c)(me);u.a.render(r.a.createElement(w.a,{store:he},r.a.createElement(v.Provider,{value:new k},r.a.createElement(oe,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},75:function(e,t,n){e.exports=n(141)},80:function(e,t,n){}},[[75,2,1]]]);
//# sourceMappingURL=main.183bbf47.chunk.js.map